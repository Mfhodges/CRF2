{% extends "base_generic.html" %}
{% load rest_framework %}
{% block schools %}active{% endblock %}
{% block content %}
<div class="medium-container">

  <h1> Schools</h1>


  <!--<p> previous{{ data.previous }} </p>
  <p> next{{ data.next}} </p>
  <p> num_pages{{ data.total_pages}} </p> -->


    <table class="striped-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Abbr.</th>
          <th>Visibility</th>
        </tr>
      </thead>
      <tbody>
        {% for school in results %}
        <tr>
          {% if school.visible == True %}
          <td><a href="/courses/?school={{ school.abbreviation }}">{{school.name}}</a></td>
          {% else %}
          <td>{{school.name}}</td>
          {% endif %}
          <td>{{school.abbreviation}}</td>
          <td>

            <!-- <form action="{% url 'school-detail' pk=1 %}" method="POST"> -->
            {% if user.is_staff %}
                {% if school.visible == True %}
                <!--  -->
                <button class="button" data-toggle="modal" data-target="#SchoolModal" data-school="{{school.name}}" data-abbr="{{school.abbreviation}}" data-id="{{ school.id }}" data-visible='false'>
                  <b>REMOVE</b> <i class="fas fa-minus-square"></i>
                </button>
              TRUE (click button to remove)
                {% else %}
                <!-- data-school="{{school.name}}" data-abbr="{{school.abbreviation}}" data-id="{{ school.id }}" data-visible='true' -->
                <button class="button" data-toggle="modal" data-target="#SchoolModal" data-school="{{school.name}}" data-abbr="{{school.abbreviation}}" data-id="{{ school.id }}" data-visible='true'>
                  <b>ADD</b> <i class="fas fa-plus-square"></i>
                </button>
                FALSE (click button to add)
              {% endif %}
            {% else %}
              {% if subject.visible == True %}
                TRUE
              {% else %}
                  FALSE
              {% endif %}
            {% endif %}


          </td>
        </tr>
          {% endfor %}
      </tbody>
    </table>


    <!-- Modal -->
    <!-- simplify with this https://getbootstrap.com/docs/4.0/components/modal/#varying-modal-content -->

    <div class="modal fade" id="SchoolModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle"> Change Visibility </h5>
            <div class="close" data-dismiss="modal" aria-label="Close">
              <i class="fas fa-times"></i>
            </div>
          </div>
          <form id="form" action="" data-method="PUT" enctype="multipart/form-data">
            {% csrf_token %}
              <div class="modal-body">
                <p> Are you sure that you want to change the visibility ? </p>
              </div>
              <div class="modal-footer">
                <input name="name" type="hidden" class="form-control" type="text" value="">
                <input name="abbreviation" type="hidden" class="form-control" type="text" value="">
                <input name="visible" type="hidden" class="form-control" type="text" value="">

                <button type="submit" value="save" style="font-weight: 600;">Submit</button>
              </div>
          </form>
        </div>
      </div>
    </div>





    <!-- PAGINATION -->
    {% if paginator %}
      <nav aria-label="Page navigation" class="vertical-center">
        {% get_pagination_html paginator %}
      </nav>
    {% endif %}



</div>
{% endblock %}


{% block template_page_js %}
<script>
// For the school List View
$('#SchoolModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var school = button.data('school') // Extract info from data-* attributes
  var id = button.data('id')
  var vis = button.data('visible')
  var abbr = button.data('abbr')
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  console.log(school,id,vis)
  $('#form').attr('action', '/schools/' + id + '/')
  var modal = $(this)

  modal.find('.modal-title').text('Change Visibility for: ' + school)
  modal.find(".modal-footer input[name='name']").val(school)
  modal.find(".modal-footer input[name='abbreviation']").val(abbr)
  modal.find(".modal-footer input[name='visible']").val(vis)
})
$(document).ready(function() {
        $('form').ajaxForm();
    });
</script>


{% endblock %}
