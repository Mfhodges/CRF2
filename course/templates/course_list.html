{% extends "base_generic.html" %}
{% load rest_framework %}
{% load template_extra %}
<!-- this sets the nav li to active -->
{% block courses %}active{% endblock %}
<!-- see for date format info https://docs.djangoproject.com/en/2.1/ref/settings/#date-input-formats -->

{% block content %}



  <!-- add filtering bit -->

<h1>Courses</h1>
<!--   <i class="fas fa-info-circle"></i> -->


<!-- FILTERING-->
{% include "bits/filter_content.html" %}

<!--  <button style="float: right; margin-right: 10px" data-toggle="modal" data-target="#filtersModal" class="btn btn-default">
    <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
    <p> {{request}}</p>
  </button> -->



<!-- TABLE -->

  <table class="striped-table">
    <thead>
      <tr>
        <th style="width:20%;">Section</th>
        <th style="width:25%;">Title</th>
        <th>Activity</th>
        <th id="instructors">Instructor</th>
        <!--<th>Created Date</th> -->
        <th style="white-space: nowrap;">Request Status</th>
      </tr>
    </thead>
    <tbody>
      {% for course in results %}
      <tr>

        <td><a href='{% url "UI-course-detail" course_code=course.course_code %}'>{{ course|asrepr }} </a></td>
        <td>{{ course.course_name }}</td>
        <td>{{ course.course_activity }}</td>

        <td id="instructors">
          {% if course.instructors|length == 0 %} STAFF {% else %}
          {{ course.instructors| join:", "}} {% endif %}
        </td>
        <!-- some how the time is being stored as a string ... -->
  <!--      <td>{{ course.created }} a {{ course.created|time:'h:i' }} b {{ course.created|date:"SHORT_DATE_FORMAT" }} </td> -->

        <!--<td>{{course.created|date:'m/d/Y'}} {{course.created|time:'h:i' }}</td> -->
        <td style="padding-left:4%;">
          <!-- REQUEST MODAL -->
        <!--  {{course.requested}} -->
          {% if course.requested == True %}
              <!-- this button should pull up the submitted request! -->
              <a  href='{% url "UI-request-detail" pk=course.course_code %}' class="button muted-button" data-toggle="tooltip" data-placement="top" title="click to see details">Requested</a>
          {% else %}
            <!--  <input type="hidden" name="requested" value="true">
              <button type="submit" class="button" >Request</button>-->
              <!-- Button trigger modal -->
              <button class="button" data-toggle="modal" data-target="#CourseModal" data-course="{{ course|asrepr }}">
                Request
              </button>
          {% endif %}
        </td>
      </tr>
        {% endfor %}
    </tbody>
  </table>


<!-- END TABLE -->


  <!-- Modal -->
  <!-- simplify with this https://getbootstrap.com/docs/4.0/components/modal/#varying-modal-content -->

  <div class="modal fade" id="CourseModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle"> Basic Request For </h5>
          <div class="close" data-dismiss="modal" aria-label="Close">
            <i class="fas fa-times"></i>
          </div>
        </div>
        <form action="{% url 'UI-request-list' %}" method="post">
          {% csrf_token %}
            <div class="modal-body">
              <label for="inputCanvasID">Copy From Canvas Site </label>
              <input type="text" id="inputCanvasID" name="copy_from_course" class="form-control" placeholder="CANVAS SITE ID" aria-describedby="textHelpInline">
              <small id="passwordHelpInline" class="text-muted">
                Canvas Site ID is found in `https://canvas.upenn.edu/courses/&lt;CANVAS_ID&gt;`
                If left blank, the course created will have no content copied.
              </small>
            </div>
            <div class="modal-footer">
              <input name="course_requested" type="hidden"class="form-control" type="text" value="">
              <input name="status" class="form-control" type="hidden" value="SUBMITTED">
              <input name="view_type" class="form-control" type="hidden" value="UI-course-list">
              <a href='' type="button" class="button accent-button" style="font-weight: 600;">Custom Request</a> <!-- Custom Request takes you to the full page form -->
              <button type="submit" value="save" style="font-weight: 600;">Submit request</button>
            </div>
        </form>
      </div>
    </div>
  </div>
<!-- END COURSE REQUEST MODAL -->



<!-- MODAL FILTERING-->
  {% include "bits/filter_modal.html" %}

<!--
<div class="modal fade" id="FilterModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Add Filter </h5>
        <div class="close" data-dismiss="modal" aria-label="Close">
          <i class="fas fa-times"></i>
        </div>
      </div>
      <form id="filterform" action="" method="GET">
          <div class="modal-body">
            <p><mark> no validation of fields.</mark></p>
                {{ filter.form.as_p }}
          </div>
          <div class="modal-footer">
            <button onSubmit="mySubmitFunction()" id="submit-id-" type="submit" value="Submit" style="font-weight: 600;">Filter</button>
          </div>
      </form>
    </div>
  </div>
</div>-->
<!-- END MODAL FILTERING -->





  <!-- PAGINATION -->
  {% include "bits/paginator.html" %}

{% endblock %}


{% block template_page_js %}
<script>
// For the Course List View
$('#CourseModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var course = button.data('course') // Extract info from data-* attributes
  var short_course = course.replace(/_/g,'')
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  console.log(course.replace('_',''))
  var modal = $(this)
  modal.find('.modal-title').text('Basic Request for ' + course)
  modal.find(".modal-footer input[name='course_requested']").val(short_course)
  modal.find(".modal-footer a").attr("href", '/courses/'+ short_course +'#RequestForm')
})

//$('#CourseModal').on('show.bs.modal', function (event) {
  //var button = $(event.relatedTarget) // Button that triggered the modal
  //var param = button.data('param') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
//  var modal = $(this)
//  modal.find('.modal-title').text('Filtering Results by ' + param)
//  modal.find(".modal-body input").attr("name",param)
//})

// removes null query_params ! <3
$('form[method="get"]').submit(function(){
    $(this).find(':input').each(function() {
        var inp = $(this);
        if (!inp.val()) {
            inp.remove();
        }
    });
});



</script>

{% endblock %}
